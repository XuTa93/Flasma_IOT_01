<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:Flasma_IOT_01.ViewModels" 
        xmlns:lvc="using:LiveChartsCore.SkiaSharpView.Avalonia"
        xmlns:dataGrid="clr-namespace:Avalonia.Controls;assembly=Avalonia.Controls.DataGrid"
        mc:Ignorable="d"
        Width="1100"
        Height="700"
        x:Class="Flasma_IOT_01.Views.MainWindow"
        Title="Flasma IOT"
        x:DataType="vm:MainWindowViewModel">

    <Grid RowDefinitions="*,Auto">

        <!-- ================= TAB AREA ================= -->
        <TabControl Grid.Row="0"
            HorizontalContentAlignment="Stretch"
            VerticalContentAlignment="Stretch">


            <!-- ================= HISTORY TAB ================= -->
          <TabItem Header="History">
    <Grid RowDefinitions="*">

<dataGrid:DataGrid
    ItemsSource="{Binding HistoryRecords}"
    AutoGenerateColumns="False"
    HeadersVisibility="Column"
    GridLinesVisibility="All"
    BorderThickness="1"
    HorizontalAlignment="Stretch"
    VerticalAlignment="Stretch"
    ColumnWidth="*"
    CanUserResizeColumns="True"
    HorizontalScrollBarVisibility="Disabled"
    VerticalScrollBarVisibility="Auto">

<dataGrid:DataGrid.Columns>

    <dataGrid:DataGridTextColumn Header="ID"
                                 Binding="{Binding Id}"
                                 Width="Auto"/>

    <dataGrid:DataGridTextColumn Header="Start Time"
                                 Binding="{Binding StartTime}"
                                 Width="*"/>

    <dataGrid:DataGridTextColumn Header="End Time"
                                 Binding="{Binding EndTime}"
                                 Width="*"/>

    <dataGrid:DataGridTextColumn Header="Duration"
                                 Binding="{Binding Duration}"
                                 Width="Auto"/>

    <dataGrid:DataGridTextColumn Header="Barcode"
                                 Binding="{Binding Barcode}"
                                 Width="*"/>

    <dataGrid:DataGridTextColumn Header="Result"
                                 Binding="{Binding Result}"
                                 Width="Auto"/>

    <dataGrid:DataGridTextColumn Header="NG Content"
                             Binding="{Binding NgContent}"
                             Width="2*"/>

    <dataGrid:DataGridTextColumn Header="Avg Voltage"
                                 Binding="{Binding AvgVoltage}"
                                 Width="*"/>

    <dataGrid:DataGridTextColumn Header="Avg Current"
                                 Binding="{Binding AvgCurrent}"
                                 Width="*"/>

    <dataGrid:DataGridTextColumn Header="Avg Power"
                                 Binding="{Binding AvgPower}"
                                 Width="*"/>
    <!-- C?T DÀI NH?T -->
    <dataGrid:DataGridTextColumn Header="File Path"
                                 Binding="{Binding FilePath}"
                                 Width="2*"/>

</dataGrid:DataGrid.Columns>


        </dataGrid:DataGrid>

    </Grid>
</TabItem>

            <!-- ================= CHART TAB ================= -->
<TabItem Header="Chart">
    <Border Background="#1A1A1A"
            Padding="20">

        <!-- CHIA MÀN HÌNH LÀM 2 C?T -->
        <Grid ColumnDefinitions="*,*">

            <!-- ===== LEFT AREA: CHARTS (50%) ===== -->
            <Grid Grid.Column="0"
                  RowDefinitions="*,*"
                  RowSpacing="10">

                <!-- VOLTAGE CHART -->
                <Border Grid.Row="0"
                        Background="#1A1A1A"
                        BorderBrush="#444"
                        BorderThickness="1"
                        Padding="5,10,5,5">

                    <Grid RowDefinitions="Auto,*">
                        <TextBlock Grid.Row="0"
                                   Text="Voltage (V)"
                                   Foreground="White"
                                   FontSize="16"
                                   FontWeight="Bold"
                                   HorizontalAlignment="Center"
                                   Margin="0,0,0,5"/>

                        <lvc:CartesianChart Grid.Row="1"
                                            Series="{Binding VoltageSeries}"
                                            XAxes="{Binding VoltageXAxes}"
                                            YAxes="{Binding VoltageYAxes}"
                                            LegendPosition="Hidden"
                                            Background="#1A1A1A"/>
                    </Grid>
                </Border>

                <!-- CURRENT CHART -->
                <Border Grid.Row="1"
                        Background="#1A1A1A"
                        BorderBrush="#444"
                        BorderThickness="1"
                        Padding="5,10,5,5">

                    <Grid RowDefinitions="Auto,*">
                        <TextBlock Grid.Row="0"
                                   Text="Current (A)"
                                   Foreground="White"
                                   FontSize="16"
                                   FontWeight="Bold"
                                   HorizontalAlignment="Center"
                                   Margin="0,0,0,5"/>

                        <lvc:CartesianChart Grid.Row="1"
                                            Series="{Binding CurrentSeries}"
                                            XAxes="{Binding CurrentXAxes}"
                                            YAxes="{Binding CurrentYAxes}"
                                            LegendPosition="Hidden"
                                            Background="#1A1A1A"/>
                    </Grid>
                </Border>

            </Grid>

            <!-- ===== RIGHT AREA: EMPTY (50%) ===== -->
            <Border Grid.Column="1"
                    Background="#111"
                    BorderBrush="#333"
                    BorderThickness="1"
                    CornerRadius="6"
                    Padding="12">

                <StackPanel Spacing="12">

                    <!-- ===== DATE PICKER ===== -->
                    <TextBlock Text="Select date"
                               Foreground="White"
                               FontSize="14"
                               FontWeight="Bold"/>

                    <CalendarDatePicker
                        SelectedDate="{Binding SelectedSummaryDate, Mode=TwoWay}"
                        DisplayDateEnd="{Binding Today}"
                        HorizontalAlignment="Stretch"/>

                    <!-- ===== DONUT CHART ===== -->
                    <Grid Height="260">

                        <lvc:PieChart
                                    Series="{Binding SummarySeries}"
                                    LegendPosition="Hidden"
                                    InitialRotation="-90"
                                    Background="Black"/>

                        <!-- CENTER TEXT -->
                        <StackPanel HorizontalAlignment="Center"
                                    VerticalAlignment="Center">
                            <TextBlock Text="TOTAL"
                                       Foreground="#AAA"
                                       FontSize="14"
                                       HorizontalAlignment="Center"/>

                            <TextBlock Text="{Binding TotalCount}"
                                       Foreground="White"
                                       FontSize="28"
                                       FontWeight="Bold"
                                       HorizontalAlignment="Center"/>
                        </StackPanel>

                    </Grid>
                    <dataGrid:DataGrid
                        ItemsSource="{Binding Last5DaysSummary}"
                        AutoGenerateColumns="False"
                        HeadersVisibility="Column"
                        GridLinesVisibility="Horizontal"
                        Height="280"
                        Margin="0,10,0,0"
                        HorizontalAlignment="Stretch"
                        Background="#1E1E1E"
                        BorderBrush="#444"
                        BorderThickness="1">

                        <!-- ===== STYLES (CÁCH ?ÚNG AVALONIA) ===== -->
                        <dataGrid:DataGrid.Styles>

                            <!-- HEADER -->
                            <Style Selector="DataGridColumnHeader">
                                <Setter Property="Background" Value="#2A2A2A"/>
                                <Setter Property="Foreground" Value="#CCCCCC"/>
                                <Setter Property="FontWeight" Value="SemiBold"/>
                                <Setter Property="HorizontalContentAlignment" Value="Center"/>
                                <Setter Property="BorderBrush" Value="#444"/>
                            </Style>

                            <!-- ROW M?C ??NH -->
                            <Style Selector="DataGridRow">
                                <Setter Property="Background" Value="#1E1E1E"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Style>

                            <!-- ROW CH?N (ALTERNATING) -->
                            <Style Selector="DataGridRow:nth-child(even)">
                                <Setter Property="Background" Value="#252525"/>
                            </Style>

                            <!-- CELL -->
                            <Style Selector="DataGridCell">
                                <Setter Property="BorderBrush" Value="#333"/>
                                <Setter Property="HorizontalContentAlignment" Value="Center"/>
                            </Style>

                        </dataGrid:DataGrid.Styles>

                        <dataGrid:DataGrid.Columns>

                            <dataGrid:DataGridTextColumn Header="Date"
                                                         Binding="{Binding Label}"
                                                         Width="80"/>

                            <dataGrid:DataGridTextColumn Header="15/1/2026"
                                                         Binding="{Binding Day1}"
                                                         Width="*"/>

                            <dataGrid:DataGridTextColumn Header="16/1/2026"
                                                         Binding="{Binding Day2}"
                                                         Width="*"/>

                            <dataGrid:DataGridTextColumn Header="17/1/2026"
                                                         Binding="{Binding Day3}"
                                                         Width="*"/>

                            <dataGrid:DataGridTextColumn Header="18/1/2026"
                                                         Binding="{Binding Day4}"
                                                         Width="*"/>

                            <dataGrid:DataGridTextColumn Header="19/1/2026"
                                                         Binding="{Binding Day5}"
                                                         Width="*"/>

                        </dataGrid:DataGrid.Columns>
                    </dataGrid:DataGrid>

                    <!-- ===== LEGEND ===== -->
                    <StackPanel Orientation="Horizontal"
                                HorizontalAlignment="Center"
                                Spacing="20">

                        <StackPanel Orientation="Horizontal" Spacing="6">
                            <Ellipse Width="10" Height="10" Fill="Lime"/>
                            <TextBlock Text="{Binding OkCountLabel}"
                                       Foreground="White"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Spacing="6">
                            <Ellipse Width="10" Height="10" Fill="Red"/>
                            <TextBlock Text="{Binding NgCountLabel}"
                                       Foreground="White"/>
                        </StackPanel>

                    </StackPanel>

                </StackPanel>
            </Border>


        </Grid>
    </Border>
</TabItem>

            <!-- ================= ALARM TAB ================= -->
<!-- ================= ALARM TAB ================= -->
<TabItem Header="Alarm">
    <Grid RowDefinitions="*">
        
<dataGrid:DataGrid
    ItemsSource="{Binding AlarmRecords}"
    AutoGenerateColumns="False"
    HeadersVisibility="Column"
    GridLinesVisibility="All"
    BorderThickness="1"
    HorizontalAlignment="Stretch"
    VerticalAlignment="Stretch"
    ColumnWidth="*"
    CanUserResizeColumns="True"
    HorizontalScrollBarVisibility="Disabled"
    VerticalScrollBarVisibility="Auto">

<dataGrid:DataGrid.Columns>

    <dataGrid:DataGridTextColumn Header="No."
                                 Binding="{Binding No}"
                                 Width="Auto"/>

    <dataGrid:DataGridTextColumn Header="Name Alarm"
                                 Binding="{Binding NameAlarm}"
                                 Width="2*"/>

    <!-- STATUS -->
    <dataGrid:DataGridTemplateColumn Header="Status"
                                     Width="*">
        <dataGrid:DataGridTemplateColumn.CellTemplate>
            <DataTemplate>
                <TextBlock Text="{Binding Status}"
                           Foreground="{Binding StatusColor}"
                           FontWeight="{Binding StatusFontWeight}"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Center"/>
            </DataTemplate>
        </dataGrid:DataGridTemplateColumn.CellTemplate>
    </dataGrid:DataGridTemplateColumn>

    <dataGrid:DataGridTextColumn Header="Time"
                                 Binding="{Binding Timestamp}"
                                 Width="*"/>

</dataGrid:DataGrid.Columns>

        </dataGrid:DataGrid>

    </Grid>
</TabItem>
        </TabControl>

        <!-- ================= CONTROL PANEL ================= -->
        <Grid Grid.Row="1"
              Margin="10"
              ColumnDefinitions="*,350"
              RowDefinitions="Auto,Auto"
              ColumnSpacing="20">

            <!-- STATUS - BINDING V?I VIEWMODEL -->
            <StackPanel Orientation="Horizontal" Spacing="30">
                <TextBlock Text="{Binding Voltage, StringFormat='Voltage: {0:F2}V'}" VerticalAlignment="Center"/>
                <TextBlock Text="{Binding Current, StringFormat='Current: {0:F2}A'}" VerticalAlignment="Center"/>
               <TextBlock Text="{Binding Power, StringFormat='Power: {0:F2}W'}" VerticalAlignment="Center"/>
            </StackPanel>

            <!-- RIGHT STATUS -->
            <StackPanel Grid.Column="1"
                Orientation="Vertical"
                Spacing="8">

                <!-- STATUS -->
                <StackPanel Orientation="Horizontal" Spacing="10">
                    <Border Background="{Binding StatusColor}" 
                            CornerRadius="3"
                            Padding="8,4"
                            VerticalAlignment="Center">
                        <TextBlock Text="{Binding StatusText}" 
                                   FontWeight="Bold"
                                   Foreground="White"/>
                    </Border>

                    <CheckBox Content="Dummy Mode (Test)"
                              IsChecked="{Binding IsDummy, Mode=TwoWay}"/>
                </StackPanel>

            </StackPanel>


            <!-- BUTTONS -->
                <StackPanel Orientation="Horizontal"
                            Grid.Row="1"
                            Spacing="10">
                    <Button Content="Connect" Command="{Binding ButtonConnectPressedCommand}" IsEnabled="{Binding IsConnect}"/>
                    <Button Content="DisConnect" Command="{Binding ButtonDisconnectPressedCommand}" IsEnabled="{Binding IsDisConnect}"/>
                    <Button Content="Start" Command="{Binding ButtonStartPressedCommand}" IsEnabled="{Binding IsStart}"/>
                    <Button Content="Stop" Command="{Binding ButtonStopPressedCommand}" IsEnabled="{Binding IsStop}"/>
                    <TextBlock Text="Barcode"
                           VerticalAlignment="Center"
                           Margin="20,0,0,0"/>
                    <TextBox Width="150" Text="{Binding BarcodeText}"
                         Watermark="Code text"/>
               </StackPanel>

                <StackPanel Grid.Column="1" Grid.Row="1" 
                                Orientation="Horizontal"
                                Spacing="5"
                                HorizontalAlignment="Right"
                                Margin="0,0,40,0">
                        <!-- ===== REAL TIME CLOCK (THÊM M?I) ===== -->
                <Border BorderBrush="#555"
                        BorderThickness="1"
                        CornerRadius="4"
                        Padding="8"
                        Background="#1F1F1F"
                        VerticalAlignment="Center">

                    <TextBlock Text="{Binding CurrentDateTime}"
                               x:CompileBindings="False"
                               Foreground="#DDD"
                               FontSize="14"
                               FontWeight="SemiBold"/>
                </Border>
                                           
                    </StackPanel>

        </Grid>

    </Grid>
</Window>