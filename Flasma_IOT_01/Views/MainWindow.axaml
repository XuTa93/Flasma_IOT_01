<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:Flasma_IOT_01.ViewModels" 
        xmlns:lvc="using:LiveChartsCore.SkiaSharpView.Avalonia"
        xmlns:dataGrid="clr-namespace:Avalonia.Controls;assembly=Avalonia.Controls.DataGrid"
        mc:Ignorable="d"
        Width="1100"
        Height="700"
        x:Class="Flasma_IOT_01.Views.MainWindow"
        Title="Flasma IOT"
        x:DataType="vm:MainWindowViewModel">

    <Grid RowDefinitions="*,Auto">

        <!-- ================= TAB AREA ================= -->
        <TabControl Grid.Row="0"
            HorizontalContentAlignment="Stretch"
            VerticalContentAlignment="Stretch">


            <!-- ================= HISTORY TAB ================= -->
          <TabItem Header="History">
    <Grid RowDefinitions="*">

        <dataGrid:DataGrid
            x:CompileBindings="False"
            ItemsSource="{Binding HistoryRecords}"
            AutoGenerateColumns="False"
            HeadersVisibility="Column"
            GridLinesVisibility="All"
            BorderThickness="1"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Stretch"
            ColumnWidth="Auto">

            <dataGrid:DataGrid.Columns>
                <dataGrid:DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="80"/>
                <dataGrid:DataGridTextColumn Header="Start Time" Binding="{Binding StartTime}" Width="150"/>
                <dataGrid:DataGridTextColumn Header="End Time" Binding="{Binding EndTime}" Width="150"/>
                <dataGrid:DataGridTextColumn Header="Duration" Binding="{Binding Duration}" Width="120"/>
                <dataGrid:DataGridTextColumn Header="Barcode" Binding="{Binding Barcode}" Width="150"/>
                <dataGrid:DataGridTextColumn Header="Result" Binding="{Binding Result}" Width="100"/>
                <dataGrid:DataGridTextColumn Header="Avg Voltage" Binding="{Binding AvgVoltage}" Width="130"/>
                <dataGrid:DataGridTextColumn Header="Avg Current" Binding="{Binding AvgCurrent}" Width="100"/>
                <dataGrid:DataGridTextColumn Header="File Path" Binding="{Binding FilePath}" Width="300"/>
            </dataGrid:DataGrid.Columns>

        </dataGrid:DataGrid>

    </Grid>
</TabItem>


            <!-- ================= CHART TAB ================= -->
            <TabItem Header="Chart">
                <!-- Gi? nguyên ph?n Chart -->
                <Border Background="#1A1A1A"
                        Padding="20">
                    <Grid RowDefinitions="*,*"
                          RowSpacing="10">
            
                        <!-- VOLTAGE CHART -->
                        <Border Grid.Row="0"
                                Background="#1A1A1A"
                                BorderBrush="#444"
                                BorderThickness="1"
                                Padding="5,10,5,5">
                            <Grid RowDefinitions="Auto,*">
                                <TextBlock Grid.Row="0"
                                           Text="Voltage (V)"
                                           Foreground="White"
                                           FontSize="16"
                                           FontWeight="Bold"
                                           HorizontalAlignment="Center"
                                           Margin="0,0,0,5"/>
                                <!-- VOLTAGE CHART -->
                                <lvc:CartesianChart Grid.Row="1"
                                                    Series="{Binding VoltageSeries}"
                                                    XAxes="{Binding VoltageXAxes}"
                                                    YAxes="{Binding VoltageYAxes}"
                                                    LegendPosition="Hidden"
                                                    Background="#1A1A1A">
                                    <lvc:CartesianChart.Styles>
                                        <Style Selector="TextBlock">
                                            <Setter Property="FontSize" Value="12"/>
                                        </Style>
                                    </lvc:CartesianChart.Styles>
                                </lvc:CartesianChart>
                            </Grid>
                        </Border>

                        <!-- CURRENT CHART -->
                        <Border Grid.Row="1"
                                Background="#1A1A1A"
                                BorderBrush="#444"
                                BorderThickness="1"
                                Padding="5,10,5,5">
                            <Grid RowDefinitions="Auto,*">
                                <TextBlock Grid.Row="0"
                                           Text="Current (A)"
                                           Foreground="White"
                                           FontSize="16"
                                           FontWeight="Bold"
                                           HorizontalAlignment="Center"
                                           Margin="0,0,0,5"/>
                                <!-- CURRENT CHART -->
                                <lvc:CartesianChart Grid.Row="1"
                                                    Series="{Binding CurrentSeries}"
                                                    XAxes="{Binding CurrentXAxes}"
                                                    YAxes="{Binding CurrentYAxes}"
                                                    LegendPosition="Hidden"
                                                    Background="#1A1A1A">
                                    <lvc:CartesianChart.Styles>
                                        <Style Selector="TextBlock">
                                            <Setter Property="FontSize" Value="12"/>
                                        </Style>
                                    </lvc:CartesianChart.Styles>
                                </lvc:CartesianChart>
                            </Grid>
                        </Border>

                    </Grid>
                </Border>
            </TabItem>

        </TabControl>

        <!-- ================= CONTROL PANEL ================= -->
        <Grid Grid.Row="1"
              Margin="10"
              ColumnDefinitions="*,Auto"
              RowDefinitions="Auto,Auto"
              ColumnSpacing="20">

            <!-- STATUS - BINDING V?I VIEWMODEL -->
            <StackPanel Orientation="Horizontal" Spacing="30">
                <TextBlock Text="{Binding Voltage, StringFormat='Voltage: {0:F2}V'}" VerticalAlignment="Center"/>
                <TextBlock Text="{Binding Current, StringFormat='Current: {0:F2}A'}" VerticalAlignment="Center"/>
               <TextBlock Text="{Binding Power, StringFormat='Power: {0:F2}W'}" VerticalAlignment="Center"/>
            </StackPanel>

            <!-- RIGHT STATUS -->
<StackPanel Grid.Column="1"
            Orientation="Vertical"
            Spacing="8">

    <!-- STATUS -->
    <StackPanel Orientation="Horizontal" Spacing="10">
        <Border Background="{Binding StatusColor}" 
                CornerRadius="3"
                Padding="8,4"
                VerticalAlignment="Center">
            <TextBlock Text="{Binding StatusText}" 
                       FontWeight="Bold"
                       Foreground="White"/>
        </Border>

        <CheckBox Content="Dummy Mode (Test)"
                  IsChecked="{Binding IsDummy, Mode=TwoWay}"/>
    </StackPanel>

    <!-- ===== RESULT SUMMARY ===== -->
    <Border BorderBrush="#555"
            BorderThickness="1"
            CornerRadius="4"
            Padding="8"
            Background="#1F1F1F">

        <Grid ColumnDefinitions="Auto,Auto"
              RowDefinitions="Auto,Auto"
              ColumnSpacing="20"
              RowSpacing="6">

            <TextBlock Text="OK"
                       Foreground="Lime"
                       FontWeight="Bold"/>

            <TextBlock Grid.Column="1"
                       Text="{Binding OkCount}"
                       Foreground="Lime"
                       FontWeight="Bold"
                       HorizontalAlignment="Right"/>

            <TextBlock Grid.Row="1"
                       Text="NG"
                       Foreground="Red"
                       FontWeight="Bold"/>

            <TextBlock Grid.Row="1"
                       Grid.Column="1"
                       Text="{Binding NgCount}"
                       Foreground="Red"
                       FontWeight="Bold"
                       HorizontalAlignment="Right"/>
        </Grid>
    </Border>
</StackPanel>


            <!-- BUTTONS -->
            <StackPanel Grid.Row="1"
                        Orientation="Horizontal"
                        Spacing="10">

                <Button Content="Connect" Command="{Binding ButtonConnectPressedCommand}" IsEnabled="{Binding IsConnect}"/>
                <Button Content="DisConnect" Command="{Binding ButtonDisconnectPressedCommand}" IsEnabled="{Binding IsDisConnect}"/>
                <Button Content="Start" Command="{Binding ButtonStartPressedCommand}" IsEnabled="{Binding IsStart}"/>
                <Button Content="Stop" Command="{Binding ButtonStopPressedCommand}" IsEnabled="{Binding IsStop}"/>

                <TextBlock Text="Barcode"
                           VerticalAlignment="Center"
                           Margin="20,0,0,0"/>

                <TextBox Width="150" Text="{Binding BarcodeText}"
                         Watermark="Code text"/>
            </StackPanel>

        </Grid>

    </Grid>
</Window>